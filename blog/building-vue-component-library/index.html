<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><style type="text/css">*{box-sizing:border-box}html{font-size:16px}body{font-family:sans-serif;font-size:1rem;line-height:1.5rem}nav{margin:1rem 5%}body,nav ul{margin:0;padding:0}nav li{display:inline;margin:0 1rem}nav li:first-child{margin-left:0}@media screen and (min-width:670px){nav{margin-left:1rem}}main{width:90%;max-width:720px;margin:3rem auto}em,h1,h1 span,h2,h2 span,h3,h3 span,h4,h4 span,li code,p code,strong{background:linear-gradient(90deg,#9e009e 0%,#ff007f 49%,#d98400 100%);-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent}h1,h2,h3,h4{font-family:sans-serif}h1{margin:2rem 0 1.5rem;font-size:2.5rem;line-height:3rem;font-weight:300;display:table}h2{margin:2rem 0 1rem;font-size:2rem;line-height:2.5rem;font-weight:400}h3,h4{font-weight:500}h3{font-size:1.5rem;line-height:2rem;margin:1rem 0 .5rem}blockquote,h4,iframe,ol,p,ul{font-size:1rem;line-height:1.5rem}h4{margin:.5rem 0}blockquote,hgroup,iframe,ol,p,ul{margin:1rem 0}hgroup h1,hgroup h2,hgroup h3,hgroup h4{margin:0}blockquote code,iframe code,ol code,p code,sup.footnote-ref,ul code{line-height:.5rem}ol,ul{padding:0 0 0 1.5rem}footer img{height:24px}section{padding:1rem 0}hr{margin:2rem 0}sup.footnote-ref{font-size:1rem}blockquote{border-left:6px rgba(1,1,1,.05) solid;background-color:rgba(1,1,1,.05);padding:.5rem .5rem .5rem 1rem}dt{margin-top:1rem}dd{margin-bottom:1rem;margin-left:1rem}</style><title>Adam Buczek | Async component library with Vue</title><meta name="description" content=""></head><body><nav><ul><li><a href="/">Adam Buczek</a></li>|<li><a href="/blog">Blog</a></li></ul></nav><main role="main"><span class="journal-entry--date">23 Nov 2020</span><img src="/assets/building-vue-component-library.png" alt="Async component library with Vue" title="Async component library with Vue"><h1>Async component library with Vue</h1><p>This is the first element of <a href="../vue-website-builder">Vue based website builder</a> — a component library, source of <em>Modules</em> that can be loaded at runtime via HTTP when they are needed.</p><p>As stated earlier <a href="../vue-website-builder/#basic-assumptions">Component Libraries must adhere to a standard</a>. Lifecycle of a component looks like this:</p><ul><li>All accessible components are listed in the UI.</li><li>A component is chosen from the list and added to a main area.</li><li>Component's content can be edited; components can be rearranged.</li></ul><p>To sum up — components must be listable, addable and editable in a standardized way. Here is how I have done it.</p><blockquote><p>An example library is available in <a href="https://github.com/adambuczek/example-vue-component-library">adambuczek/example-vue-component-library</a>.</p></blockquote><h2>Standardization and metadata<a name="standardization-and-metadata"></a></h2><p>To be referenced from the outside, each component needs an additional set of data attached to it. The data from all the components is later combined into library manifest listing all available <em>Modules</em>.</p><p>I decided on <code>manifest.json</code> file per component:</p><pre class="language-json"><code class="language-json"><span class="highlight-line"><span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token property">"displayName"</span><span class="token operator">:</span> <span class="token string">"Page Title"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"page-title"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token property">"img"</span><span class="token operator">:</span> <span class="token string">"thumb.png"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token property">"props"</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">"text"</span> <span class="token punctuation">]</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><p>These files serve as a source of truth about each <em>Module</em> and are accessible from anywhere. They are also used in the components' <code>&lt;script&gt;</code>:</p><pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> props <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./manifest.json'</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  name<span class="token punctuation">,</span></span><br><span class="highlight-line">  props</span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><p>This way the manifest alone provides almost all of the data needed to work with the <em>Module</em>. It doesn't contain the component itself but provides a way to access it.</p><p>Listable — <code>img</code> and <code>displayName</code> are mainly cosmetic and informational, and also represent the component in a user-friendly way.</p><p>Addable — <code>name</code> is what Vue sees internally and must always be hyphenated according to <a href="https://html.spec.whatwg.org/multipage/custom-elements.html#custom-elements-core-concepts">Custom Element</a> spec and <a href="https://vuejs.org/v2/style-guide/#Multi-word-component-names-essential">Vue style guide</a>.</p><p>Editable — <code>props</code> list is used to create control elements that can inject the content into the component. I will talk about it in the next post.</p><p>Example standardized components looks like this in the directory tree:</p><pre class="language-bash"><code class="language-bash"><span class="highlight-line">src</span><br><span class="highlight-line">├── components</span><br><span class="highlight-line">│   ├── CaptionedImage</span><br><span class="highlight-line">│   │   ├── index.vue</span><br><span class="highlight-line">│   │   ├── manifest.json</span><br><span class="highlight-line">│   │   └── thumb.png</span><br><span class="highlight-line">│   ├── PageTitle</span><br><span class="highlight-line">│   │   ├── index.vue</span><br><span class="highlight-line">│   │   ├── manifest.json</span><br><span class="highlight-line">│   │   └── thumb.png</span><br><span class="highlight-line">│   └── ThreeColumnText</span><br><span class="highlight-line">│       ├── index.vue</span><br><span class="highlight-line">│       ├── manifest.json</span><br><span class="highlight-line">│       └── thumb.png</span></code></pre><p>Those are very simple but they can have any functionality a Vue 2 application can.</p><h2>Build process</h2><p>Build process happens in 2 steps:</p><h3>Manifest</h3><p>All components' manifests are gathered and joined into a single <code>manifest.json</code>. I used <a href="https://www.npmjs.com/package/fast-glob">fast-glob</a> to find all manifests.</p><p>This step also takes care of copying component images to the output directory.</p><p>Full <code>create-manifest.js</code> script is <a href="https://github.com/adambuczek/example-vue-component-library/blob/master/scripts/create-manifest.js">here</a>.</p><h3>Build</h3><p>Vue CLI config doesn't allow for multiple entry/output pairs. I wanted to build components separately to be able to request them independently at runtime. Build process uses generated <code>manifest.json</code> to identify entry files. This step also fills the manifest file with paths to compiled files relative to the manifest itself.</p><p>My solution is based on <a href="https://markus.oberlehner.net/blog/distributed-vue-applications-loading-components-via-http/">Markus Oberlehner's article</a>. He describes how to use Vue CLI to build a single component.</p><pre class="language-bash"><code class="language-bash"><span class="highlight-line">vue-cli-service build --target lib <span class="token punctuation">\</span></span><br><span class="highlight-line">  --formats umd-min --no-clean <span class="token punctuation">\</span></span><br><span class="highlight-line">  --dest outputDir --name componentName inputFilePath</span></code></pre><p>Based on this I created a script that uses the data from the manifest file to trigger building multiple components in parallel. Full <code>build.js</code> script is <a href="https://github.com/adambuczek/example-vue-component-library/blob/master/scripts/build.js">here</a>.</p><p>Components in UMD format are exposed as global variables when executed in a browser, as long as Vue also is a global variable. <a href="https://markus.oberlehner.net/blog/distributed-vue-applications-loading-components-via-http/">Markus</a> provides a pattern that leverages this property and I will <a href="../building-vue-apps-in-vue-app/">use it in the UI to register components</a>.</p><p>The manifest looks like this after the build step:</p><pre class="language-json"><code class="language-json"><span class="highlight-line"><span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"example-vue-component-library"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"0.1.0"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token property">"components"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span><br><span class="highlight-line">    <span class="token punctuation">{</span></span><br><span class="highlight-line">      <span class="token property">"displayName"</span><span class="token operator">:</span> <span class="token string">"Captioned Image"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"captioned-image"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">      <span class="token property">"img"</span><span class="token operator">:</span> <span class="token string">"captioned-image-thumb.png"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">      <span class="token property">"props"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span><br><span class="highlight-line">        <span class="token string">"url"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">        <span class="token string">"alt"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">        <span class="token string">"caption"</span></span><br><span class="highlight-line">      <span class="token punctuation">]</span><span class="token punctuation">,</span></span><br><span class="highlight-line">      <span class="token property">"src"</span><span class="token operator">:</span> <span class="token string">"src/components/CaptionedImage/index.vue"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">      <span class="token property">"style"</span><span class="token operator">:</span> <span class="token string">"captioned-image.css"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">      <span class="token property">"script"</span><span class="token operator">:</span> <span class="token string">"captioned-image.umd.min.js"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">      <span class="token property">"map"</span><span class="token operator">:</span> <span class="token string">"captioned-image.umd.min.js.map"</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token punctuation">{</span></span><br><span class="highlight-line">      <span class="token property">"displayName"</span><span class="token operator">:</span> <span class="token string">"Page Title"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"page-title"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">      <span class="token property">"img"</span><span class="token operator">:</span> <span class="token string">"page-title-thumb.png"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">      <span class="token property">"props"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span><br><span class="highlight-line">        <span class="token string">"text"</span></span><br><span class="highlight-line">      <span class="token punctuation">]</span><span class="token punctuation">,</span></span><br><span class="highlight-line">      <span class="token property">"src"</span><span class="token operator">:</span> <span class="token string">"src/components/PageTitle/index.vue"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">      <span class="token property">"style"</span><span class="token operator">:</span> <span class="token string">"page-title.css"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">      <span class="token property">"script"</span><span class="token operator">:</span> <span class="token string">"page-title.umd.min.js"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">      <span class="token property">"map"</span><span class="token operator">:</span> <span class="token string">"page-title.umd.min.js.map"</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token punctuation">{</span></span><br><span class="highlight-line">      <span class="token property">"displayName"</span><span class="token operator">:</span> <span class="token string">"Three Column Text"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"three-column-text"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">      <span class="token property">"img"</span><span class="token operator">:</span> <span class="token string">"three-column-text-thumb.png"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">      <span class="token property">"props"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span><br><span class="highlight-line">        <span class="token string">"text"</span></span><br><span class="highlight-line">      <span class="token punctuation">]</span><span class="token punctuation">,</span></span><br><span class="highlight-line">      <span class="token property">"src"</span><span class="token operator">:</span> <span class="token string">"src/components/ThreeColumnText/index.vue"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">      <span class="token property">"style"</span><span class="token operator">:</span> <span class="token string">"three-column-text.css"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">      <span class="token property">"script"</span><span class="token operator">:</span> <span class="token string">"three-column-text.umd.min.js"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">      <span class="token property">"map"</span><span class="token operator">:</span> <span class="token string">"three-column-text.umd.min.js.map"</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span></span><br><span class="highlight-line">  <span class="token punctuation">]</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><p>This is an actual entry point of this component library. This is a set of data that can fetch and use any component built here.</p><h2>Components server</h2><p>For development a simple static files server will suffice. I am using <code>http-serve</code> via <code>npx</code>. It is defined in <code>package.json</code> as <code>serve-dist</code>:</p><pre class="language-bash"><code class="language-bash"><span class="highlight-line">npx http-serve --cors dist -p <span class="token number">8888</span></span></code></pre><p>This serves dist directory on port 8888 with loose cors settings — in case the client app runs on a custom domain.</p><h2>Summary</h2><p>Vue CLI via the power of UMD gives us a way of building independent Vue components. Right now its only a command line option but hopefully it is going to <a href="https://github.com/vuejs/vue-cli/issues/3922">change in the future</a>.</p><p>Apart from that Vue CLI configuration is very extensible and so is Vue Single File Components syntax. There is an example component library <a href="https://github.com/chrisvfritz/hello-vue-components">Hello Vue Components</a> authored by Chris Fritz which illustrates a case where additional metadata is kept inside vue files. This idea is certainly worth exploring.</p><p>In the next part I will build an example app that uses the components created here straight from a static files server.</p></main><footer><ul><li><a href="https://www.linkedin.com/in/adamsbuczek/"><img src="/assets/linkedin.svg" alt="LinkedIn"></a></li><li><a href="https://github.com/adambuczek"><img src="/assets/github.svg" alt="Github"></a></li><li><a href="https://codepen.io/adambuczek"><img src="/assets/codepen.svg" alt="Codepen"></a></li></ul></footer><link href="/styles/global.css" rel="stylesheet" type="text/css"><link href="/styles/print.css" media="print" rel="stylesheet" type="text/css"></body></html>