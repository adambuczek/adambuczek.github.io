<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><style type="text/css">*{box-sizing:border-box}html{font-size:16px}body{font-family:sans-serif;font-size:1rem;line-height:1.5rem}nav{margin:1rem 5%}body,nav ul{margin:0;padding:0}nav li{display:inline;margin:0 1rem}nav li:first-child{margin-left:0}@media screen and (min-width:670px){nav{margin-left:1rem}}main{width:90%;max-width:720px;margin:3rem auto}em,h1,h1 span,h2,h2 span,h3,h3 span,h4,h4 span,li code,p code,strong{background:linear-gradient(90deg,#9e009e 0%,#ff007f 49%,#d98400 100%);-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent}h1,h2,h3,h4{font-family:sans-serif}h1{margin:2rem 0 1.5rem;font-size:2.5rem;line-height:3rem;font-weight:300;display:table}h2{margin:2rem 0 1rem;font-size:2rem;line-height:2.5rem;font-weight:400}h3,h4{font-weight:500}h3{font-size:1.5rem;line-height:2rem;margin:1rem 0 .5rem}blockquote,h4,iframe,ol,p,ul{font-size:1rem;line-height:1.5rem}h4{margin:.5rem 0}blockquote,hgroup,iframe,ol,p,ul{margin:1rem 0}hgroup h1,hgroup h2,hgroup h3,hgroup h4{margin:0}blockquote code,iframe code,ol code,p code,sup.footnote-ref,ul code{line-height:.5rem}ol,ul{padding:0 0 0 1.5rem}footer img{height:24px}section{padding:1rem 0}hr{margin:2rem 0}sup.footnote-ref{font-size:1rem}blockquote{border-left:6px rgba(1,1,1,.05) solid;background-color:rgba(1,1,1,.05);padding:.5rem .5rem .5rem 1rem}dt{margin-top:1rem}dd{margin-bottom:1rem;margin-left:1rem}</style><title>Adam Buczek | Composing Functions</title><meta name="description" content=""></head><body><nav><ul><li><a href="/">Adam Buczek</a></li>|<li><a href="/blog">Blog</a></li></ul></nav><main role="main"><span class="journal-entry--date">10 Jan 2019</span><a class="journal-entry--codepen-link" href="https://codepen.io/adambuczek/pen/EGORVY"> on codepen </a><img src="/assets/composing-functions.png" alt="Composing Functions" title="Composing Functions"><h1>Composing Functions</h1><p>Take any number of functions and return one that will be applied to passed arguments from right to left. Given functions <code>a, b, c</code> this:</p><pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">const</span> abc <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span></span><br><span class="highlight-line"><span class="token function">abc</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span></span></code></pre><p>Is a more readable equivalent of:</p><pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token function">a</span><span class="token punctuation">(</span><span class="token function">b</span><span class="token punctuation">(</span><span class="token function">c</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></code></pre><h2>Tests (mocha + chai)</h2><p>I wrote a few simple functions operating on numbers:</p><pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">const</span> <span class="token function-variable function">add5</span> <span class="token operator">=</span> <span class="token parameter">augend</span> <span class="token operator">=></span> augend <span class="token operator">+</span> <span class="token number">5</span></span><br><span class="highlight-line"><span class="token keyword">const</span> <span class="token function-variable function">mult2</span> <span class="token operator">=</span> <span class="token parameter">multiplier</span> <span class="token operator">=></span> multiplier <span class="token operator">*</span> <span class="token number">2</span></span><br><span class="highlight-line"><span class="token keyword">const</span> <span class="token function-variable function">sum</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>summands</span><span class="token punctuation">)</span> <span class="token operator">=></span> summands<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> c</span><span class="token punctuation">)</span> <span class="token operator">=></span> a <span class="token operator">+</span> c<span class="token punctuation">)</span></span><br><span class="highlight-line"><span class="token keyword">const</span> <span class="token function-variable function">pow</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">base<span class="token punctuation">,</span> exponent</span><span class="token punctuation">)</span> <span class="token operator">=></span> base<span class="token operator">**</span>exponent</span></code></pre><ul><li>composing 3 functions</li><li>1 function, which returns early only calling the single function</li><li>and 0 function variant which returns a function returning first passed argument</li></ul><pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'composing functions'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'return the same value as 3 funcs'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">        <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span> </span><br><span class="highlight-line">        <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">compose</span><span class="token punctuation">(</span>add5<span class="token punctuation">,</span> mult2<span class="token punctuation">,</span> sum<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">...</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span></span><br><span class="highlight-line">            <span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token function">add5</span><span class="token punctuation">(</span><span class="token function">mult2</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token operator">...</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span><br><span class="highlight-line">    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'return the same value as 1 fn'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">        <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span> </span><br><span class="highlight-line">        <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">compose</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span></span><br><span class="highlight-line">        <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">compose</span><span class="token punctuation">(</span>pow<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span><br><span class="highlight-line">    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'return 1st argument given 0 fns'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">        <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">compose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'whatever'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token string">'whatever'</span><span class="token punctuation">)</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span></code></pre><h2>First implementation</h2><p>When passed more than 1 function it returns a function that:</p><ul><li>reverses the function array to apply functions <code>a(b(c(1,2)))</code> and not <code>c(b(a(1,2)))</code></li><li>maps functions array saving intermediate return values in an array</li><li>needs to be 'unpacked' before returning (<code>.pop()[0]</code>)</li></ul><pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">const</span> <span class="token function-variable function">compose</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>funcs</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>funcs<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=></span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></span><br><span class="highlight-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>funcs<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=></span> funcs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span></span><br><span class="highlight-line">    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">        <span class="token keyword">let</span> tempArgs <span class="token operator">=</span> args</span><br><span class="highlight-line">        <span class="token keyword">return</span> funcs<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">fn</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">            tempArgs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>tempArgs<span class="token punctuation">)</span><span class="token punctuation">]</span></span><br><span class="highlight-line">            <span class="token keyword">return</span> tempArgs</span><br><span class="highlight-line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><p>Saving intermediate values and returning only the accumulated, final value can be done easier using <code>reduce</code>.</p><h2>ReduceRight implementation</h2><p>Reversing the <code>funcs</code> array can be avoided with <code>reduceRight</code> processing an array from back to front.</p><p>Being able to compose functions accepting multiple arguments up front means operating on argument arrays. Call to the rightmost (1st) function uses spread operator <code>fn(...acc)</code>.</p><p>When <code>initialValue</code> is omitted <code>reduceRight</code> passes two last functions on first loop and starts from penultimate element (<code>funcs.length - 2</code>). First iteration applies both functions and spreads initial arguments.</p><pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">const</span> <span class="token function-variable function">compose</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>funcs</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>funcs<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=></span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></span><br><span class="highlight-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>funcs<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=></span> funcs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span></span><br><span class="highlight-line">    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">        <span class="token keyword">return</span> funcs<span class="token punctuation">.</span><span class="token function">reduceRight</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=></span></span><br><span class="highlight-line">            <span class="token punctuation">(</span>i <span class="token operator">===</span> funcs<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token function">a</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">b</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><h2>Redux implementation</h2><p>Reduces <code>funcs</code> array and accumulates functions wrapping each new function in those already iterated over effectively reversing the calling order.</p><p>It also shows that spreading an array to return its first element <code>(...args) =&gt; args[0]</code> is redundant when <code>arg =&gt; arg</code> discards all arguments but the first one.</p><p>Wrapping single function and passing it its own argument should also be simplified <code>(...args) =&gt; funcs[0](...args)</code> to <code>funcs[0]</code>.</p><pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>funcs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>funcs<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token keyword">return</span> <span class="token parameter">arg</span> <span class="token operator">=></span> arg</span><br><span class="highlight-line">  <span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>funcs<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token keyword">return</span> funcs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">  <span class="token keyword">return</span> funcs<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token function">b</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre></main><footer><ul><li><a href="https://www.linkedin.com/in/adamsbuczek/"><img src="/assets/linkedin.svg" alt="LinkedIn"></a></li><li><a href="https://github.com/adambuczek"><img src="/assets/github.svg" alt="Github"></a></li><li><a href="https://codepen.io/adambuczek"><img src="/assets/codepen.svg" alt="Codepen"></a></li></ul></footer><link href="/styles/global.css" rel="stylesheet" type="text/css"><link href="/styles/print.css" media="print" rel="stylesheet" type="text/css"></body></html>