<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><style type="text/css">@import url(https://fonts.googleapis.com/css?family=Montserrat:300,400,600|Roboto+Slab);*{box-sizing:border-box}html{font-size:16px}body{font-family:'Roboto Slab',serif;padding:0;font-size:1rem;line-height:1.5rem}main{width:90%;max-width:600px;margin:3rem auto}h1,h2,h3,h4,h5{color:#30322d;font-family:'Montserrat',sans-serif}h2{font-weight:400;margin:2rem 0 1rem;font-size:2rem;line-height:2.5rem}h1{margin:2rem 0 1.5rem;font-size:2.5rem;line-height:3rem;font-weight:300}h3{margin:1rem 0 .5rem;font-size:1.5rem;line-height:2rem}h4,h5{margin:.5rem 0}h3,h4{font-weight:600}blockquote,h4,h5,iframe,ol,p,ul{font-size:1rem;line-height:1.5rem}h5{font-weight:400}blockquote,hgroup,iframe,ol,p,ul{margin:1rem 0}body,hgroup h1,hgroup h2,hgroup h3,hgroup h4,hgroup h5{margin:0}blockquote code,iframe code,ol code,p code,sup.footnote-ref,ul code{line-height:.5rem}ol,ul{padding:0 0 0 1rem}footer img{height:24px}section{padding:1rem 0}hr{margin:2rem 0}sup.footnote-ref{font-size:1rem}blockquote{border-left:6px rgba(1,1,1,.1) solid;background-color:rgba(1,1,1,.1);padding-left:1rem;padding-top:.5rem;padding-bottom:.5rem}</style><title>Adam Buczek | Polyfilling Bind</title><meta name="description" content=""></head><body><main role="main"><span class="journal-entry--date">14 Jan 2019</span><a class="journal-entry--codepen-link" href="https://codepen.io/adambuczek/pen/KbrebO"> on codepen</a><h1>Polyfilling Bind</h1><p>JavaScript functions have a method called <code>bind</code>. It's used to bind <code>this</code> keyword to the provided function. It returns an <a href="http://www.ecma-international.org/ecma-262/6.0/#sec-exotic-object">exotic object</a> that can't be bound again. <code>this</code> in returned function will always point to the value passed at the time of binding independently from new execution context.</p><pre class="language-js"><code class="language-js"><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token number">111</span></span><br><span class="highlight-line"><span class="token keyword">const</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">}</span></span><br><span class="highlight-line"><span class="token keyword">const</span> boundFn <span class="token operator">=</span> fn<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Window</span></span><br><span class="highlight-line"><span class="token function">boundFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 111</span></span></code></pre><h2>Tests (mocha + chai)</h2><p>Custom bound function should bind <code>this</code> value and properly handle arguments passed at bind and on bound function execution.</p><pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'custom bound function'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  </span><br><span class="highlight-line">  <span class="token function">it</span><span class="token punctuation">(</span></span><br><span class="highlight-line">    <span class="token string">'should properly bind passed value as this in returned function'</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">      <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token number">111</span></span><br><span class="highlight-line">      </span><br><span class="highlight-line">      <span class="token keyword">const</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">        <span class="token comment">// use strict mode to prevent `this` boxing</span></span><br><span class="highlight-line">        <span class="token string">'use strict'</span></span><br><span class="highlight-line">        <span class="token keyword">return</span> <span class="token keyword">this</span></span><br><span class="highlight-line">      <span class="token punctuation">}</span></span><br><span class="highlight-line">      <span class="token keyword">const</span> bound <span class="token operator">=</span> fn<span class="token punctuation">.</span><span class="token function">customBind</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span></span><br><span class="highlight-line">    </span><br><span class="highlight-line">      <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">bound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">)</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span><br><span class="highlight-line">  </span><br><span class="highlight-line">  window<span class="token punctuation">.</span>addend <span class="token operator">=</span> <span class="token number">5</span></span><br><span class="highlight-line">  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span> addend<span class="token punctuation">:</span> <span class="token number">111</span> <span class="token punctuation">}</span></span><br><span class="highlight-line">  <span class="token keyword">const</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token keyword">return</span> args<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span>c<span class="token punctuation">)</span> <span class="token operator">=></span> a <span class="token operator">+</span> c<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>addend<span class="token punctuation">)</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span></span><br><span class="highlight-line">  </span><br><span class="highlight-line">  <span class="token function">it</span><span class="token punctuation">(</span></span><br><span class="highlight-line">    <span class="token string">'should handle argumets passed to bound function'</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    </span><br><span class="highlight-line">      <span class="token keyword">const</span> customBound <span class="token operator">=</span> fn<span class="token punctuation">.</span><span class="token function">customBind</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span></span><br><span class="highlight-line">      </span><br><span class="highlight-line">      <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span></span><br><span class="highlight-line">      <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">customBound</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">126</span><span class="token punctuation">)</span></span><br><span class="highlight-line">      <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">customBound</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span><br><span class="highlight-line">        <span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>fn<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span><br><span class="highlight-line">  </span><br><span class="highlight-line">  <span class="token function">it</span><span class="token punctuation">(</span></span><br><span class="highlight-line">    <span class="token string">'should handle argumets passed on bind'</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">      <span class="token keyword">const</span> customBound <span class="token operator">=</span> fn<span class="token punctuation">.</span><span class="token function">customBind</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></span><br><span class="highlight-line">      </span><br><span class="highlight-line">      <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">customBound</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">115</span><span class="token punctuation">)</span></span><br><span class="highlight-line">      <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">customBound</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span><br><span class="highlight-line">         <span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>fn<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span></code></pre><h2>Polyfill</h2><p>Most important part of this polyfill is to create a copy of <code>this</code> at the beginning to call it using <code>apply</code> in the returned function. Rest of the code makes sure the arguments passed at binding and those passed ad execution are passed to the wrapped function.</p><pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token comment">// mocking polyfill (ES5)</span></span><br><span class="highlight-line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Function<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>customBind<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  Function<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">customBind</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token keyword">var</span> </span><br><span class="highlight-line">      <span class="token comment">// copy function (this) for reference in return value</span></span><br><span class="highlight-line">      _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">,</span></span><br><span class="highlight-line">      thisValue<span class="token punctuation">,</span></span><br><span class="highlight-line">      args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    </span><br><span class="highlight-line">    <span class="token comment">// fill args and thisValue from function passed arguments</span></span><br><span class="highlight-line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arguments<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">        args<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arguments<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span></span><br><span class="highlight-line">      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">        thisValue <span class="token operator">=</span> arguments<span class="token punctuation">[</span>i<span class="token punctuation">]</span></span><br><span class="highlight-line">      <span class="token punctuation">}</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span></span><br><span class="highlight-line">    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">      <span class="token comment">// call slice on array-like Arguments</span></span><br><span class="highlight-line">      <span class="token keyword">var</span> allArguments <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>slice<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">)</span></span><br><span class="highlight-line">      <span class="token keyword">return</span> _this<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>thisValue<span class="token punctuation">,</span> allArguments<span class="token punctuation">)</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><p>Comparing my solution with <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind#Polyfill">MDN's polyfill</a> shows that it could be more concisely done using <code>Array.prototype.slice</code> on Arguments to extract all but first elements instead of for loop.<br>Also:</p><pre class="language-js"><code class="language-js"><span class="highlight-line">args<span class="token punctuation">.</span>push<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span></span></code></pre><p>Could be used in place of</p><pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">var</span> allArguments <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>slice<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">)</span></span></code></pre><p>As <code>push.apply()</code> works for passed array-like objects and also doesn't create unnecessary copy of the array.</p></main><footer><ul><li><a href="https://www.linkedin.com/in/adamsbuczek/"><img src="/assets/linkedin.svg" alt="LinkedIn"></a></li><li><a href="https://github.com/adambuczek"><img src="/assets/github.svg" alt="Github"></a></li><li><a href="https://codepen.io/adambuczek"><img src="/assets/codepen.svg" alt="Codepen"></a></li></ul></footer><link href="/styles/global.css" rel="stylesheet" type="text/css"><link href="/styles/print.css" media="print" rel="stylesheet" type="text/css"></body></html>